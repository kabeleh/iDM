# ===========================================
# CORRECTED iDM.ini for DoubleExp potential
# ===========================================
# Key fixes:
#   1. Constrained c2*phi_ini and c4*phi_ini < 50
#   2. Reasonable c3 value (not too large)
#   3. Proper shooting parameters

# --- Output ---
output = tCl,pCl,lCl,mPk

# --- Modes ---
modes = s
ic = ad

# --- Gauge ---
gauge = newtonian

# --- Cosmological parameters ---
h = 0.6781
omega_b = 0.02238280
omega_cdm = 0.1201075
N_ur = 2.0328
T_cmb = 2.7255
YHe = 0.25

# --- Reionization ---
z_reio = 7.6711

# --- Primordial spectrum ---
A_s = 2.1e-9
n_s = 0.9665
k_pivot = 0.05

# ===========================================
# === Dark Energy: Scalar Field ===
# ===========================================

Omega_fld = 0
Omega_scf = -0.7
Omega_Lambda = 0.0

# Potential type: DoubleExp
# V(φ) = c1 * (exp(-c2*φ) + c3*exp(-c4*φ))
scf_potential = DoubleExp

# CRITICAL: Parameter constraints for numerical stability
# =======================================================
# The exponentials must not underflow:
#   c2 * phi_ini < 50  (exp(-50) ≈ 2e-22, still computable)
#   c4 * phi_ini < 50
#
# With phi_ini = 0.8:
#   c2 = 21  → c2*phi = 16.8  → exp(-16.8) ≈ 5e-8  ✓
#   c4 = 30  → c4*phi = 24.0  → exp(-24) ≈ 4e-11   ✓
#
# At phi_ini = 0.8:
#   V(0.8) = c1 * (5e-8 + 1*4e-11) ≈ 5e-15 with c1=1e-7

# Parameters: [c1, c2, c3, c4, q1, q2, q3, q4, exp1, exp2, phi_ini, phi_prime_ini]
scf_parameters = 1e-7, 21.0, 1.0, 30.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.8, 0.1

# Use user-provided initial conditions (NOT attractor solution)
attractor_ic_scf = no

# Shooting: tune c1 (index 0) to match Omega_scf
scf_tuning_index = 0

# --- Tolerance for initial conditions ---
tol_initial_Omega_r = 1e-2

# --- CDM model ---
# Standard CDM (comment out for testing without coupling)
# For interacting DM, uncomment:
#model_cdm = i
#cdm_c = 2.5

# --- Spectra ---
l_max_scalars = 2500
P_k_max_h/Mpc = 1.0

# --- Lensing ---
lensing = yes

# --- Output control ---
write_background = no
write_thermodynamics = no
write_parameters = no
write_warnings = yes

# --- Verbosity ---
input_verbose = 1
background_verbose = 2
thermodynamics_verbose = 0
perturbations_verbose = 0
